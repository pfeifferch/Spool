<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFC Produktleser</title>
<link rel="stylesheet" href="https://fonts.pc-cdn.eu/FAS/v/lastest/css/all.css">
<link rel="stylesheet" href="https://spool.pfeifferch.eu/style.css">

</head>

<body>
<div class="app">
  <button id="scan"><i class="fa-brands fa-nfc-symbol"></i><!-- <i class="fa-brands fa-nfc-directional"></i>--> NFC scannen <i class="fa-brands fa-nfc-symbol"></i><!-- <i class="fa-brands fa-nfc-directional"></i>--></button>

  <div id="scaninfo" class="scaninfo">Bitte den Scanner mit dem Button oben aktivieren und einen Tag scannen</div>
  
<div id="card" class="card">
  <div class="label">Hersteller</div>
  <div class="value" id="brand"></div>

  <div class="label">Material</div>
  <div class="value" id="type"></div>

  <div class="label">Protokoll</div>
  <div class="value" id="protocol"></div>

  <div class="label">Version</div>
  <div class="value" id="version"></div>

  <div class="label">Spool-ID</div>
  <div class="value" id="smid"></div>

  <div class="label">Temperaturbereich</div>
  <div class="value" id="temp"></div>

  <div class="label">Farbe</div>
  <div class="colorBox" id="color"></div>
</div>

<script>
const scanBtn = document.getElementById("scan");
const card = document.getElementById("card");

const brandEl = document.getElementById("brand");
const typeEl = document.getElementById("type");
const protocolEl = document.getElementById("protocol");
const versionEl = document.getElementById("version");
const smidEl = document.getElementById("smid");
const tempEl = document.getElementById("temp");
const colorBox = document.getElementById("color");

function val(v) {
  return (v !== undefined && v !== null && v !== "") ? v : "kein Eintrag gespeichert";
}

scanBtn.addEventListener("click", async () => {
  try {
    const ndef = new NDEFReader();
    await ndef.scan();

    ndef.onreading = event => {
      const record = event.message.records[0];
      const jsonString = new TextDecoder().decode(record.data);

      try {
        const data = JSON.parse(jsonString);

        brandEl.textContent    = val(data.brand);
        typeEl.textContent     = val(data.type);
        protocolEl.textContent = val(data.protocol);
        versionEl.textContent  = val(data.version);
        smidEl.textContent     = val(data.sm_id);

        if (data.min_temp && data.max_temp) {
          tempEl.textContent = `${data.min_temp}°C – ${data.max_temp}°C`;
        } else {
          tempEl.textContent = "kein Eintrag gespeichert";
        }

        if (data.color_hex) {
          colorBox.style.background = "#" + data.color_hex;
        } else {
          colorBox.style.background = "#ccc";
        }

        scaninfo.style.display = "none";
        card.style.display = "block";
      } catch (e) {
        alert("Kein gültiges JSON auf dem NFC-Tag");
      }
    };
  } catch (error) {
    alert("NFC nicht verfügbar oder Zugriff verweigert.");
  }
});
</script>

<hr class="hr-text hr-container" data-content="LINKS">
  
<div class="links-container">
  <div class="lccolumn"><a href="https://github.com/pfeifferch/Spool">
<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" class="gh-icon"></a></div>
  <div class="lccolumn"><!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="pfeifferch" data-color="#617992" data-emoji="" data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script>--></div>
  <div class="lccolumn"><a href="https://www.2.pfeifferch.eu/imprint"><i class="fas fa-gavel gh-icon"></i></a></div>
</div>

</body>
</html>
